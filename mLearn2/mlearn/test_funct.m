function [json,the1,the2,the3,d3,d2] = test_funct(X,y)

X([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],:)=[];
y([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],:)=[];

%X([75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94],:)=[];
%y([75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94],:)=[];

m = size(X,1);

%the1= [ 1/3 1/5  1/4  1/3  1/9  1/4  1/9  1/8  1/3  1/3  1/5  1/6  1/6  1/3  1/3  1/3  1/7  1/2 1/2  1/5  1/2  1/5  1/2  1/8  1/9  1/3  1/3  1/5;

%        1/6 1/5  1/9  1/3  1/9  1/4  1/5  1/8  1/3  1/2  1/5  1/8  1/6  1/3  1/4  1/3  1/7  1/2 1/2  1/8  1/2  1/5  1/2  1/4  1/9  1/3  1/3  1/5;
         
%       1/4  1/3  1/7  1/2  1/2  1/8  1/2  1/5  1/2  1/9  1/8  1/3  1/3  1/5  1/6  1/6  1/3  1/3  1/4 1/3  1/7  1/2  1/2  1/8  1/8  1/2  1/5  1/2;  

%       1/3  1/7  1/2  1/2  1/8  1/2  1/5  1/2  1/4  1/9  1/6  1/5  1/9  1/3  1/9  1/4  1/5  1/8  1/3  1/2  1/5  1/8  1/6  1/3  1/4  1/2  1/2  1/8; 

%       1/8  1/3  1/3  1/5  1/6  1/6  1/3  1/3  1/3  1/7  1/2  1/2  1/5  1/2  1/5  1/2   1/6 1/5  1/9  1/3  1/9  1/4  1/5  1/8  1/3  1/2  1/5  1/8;            
%       1/6  1/3  1/4  1/3  1/7  1/2  1/2  1/8  1/2  1/5  1/2  1/4  1/9  1/6  1/5  1/9  1/3  1/9  1/4  1/5  1/8  1/3  1/2  1/5  1/3  1/7  1/2  1/2;
 
%       1/8  1/2  1/5  1/2  1/8  1/2  1/5  1/2  1/4  1/9  1/6  1/5  1/9  1/3  1/9  1/4  1/5  1/8  1/3  1/2  1/5  1/3  1/7  1/2  1/2  1/5  1/2  1/5;
  
%       1/2   1/6 1/5  1/9  1/4  1/3  1/7  1/2  1/2  1/8  1/2  1/5  1/2  1/9  1/8  1/3  1/3  1/5  1/6  1/6  1/3  1/3  1/4  1/3  1/7  1/2  1/2  1/3;
 

%       1/3  1/7  1/2  1/8  1/3  1/3  1/5  1/6  1/6  1/3  1/3  1/3  1/7  1/2  1/2  1/5  1/2  1/5  1/9  1/4  1/3  1/7  1/2  1/2  1/8  1/2  1/5  1/2;

%       1/9  1/8  1/3  1/3  1/5  1/6  1/6  1/3  1/3  1/4  1/2   1/6 1/5  1/9  1/4  1/3  1/7  1/2  1/2  1/8  1/2  1/5  1/2  1/9  1/8  1/3  1/3  1/5]


%the2=[ 1/8  1/3  1/2  1/5  1/3  1/7  1/2  1/2  1/5  1/2  1/5;
%       1/2  1/8  1/3  1/3  1/5  1/6  1/6  1/3  1/3  1/3  1/7;
%       1/8  1/2  1/5  1/2  1/4  1/9  1/6  1/5  1/9  1/3  1/9; 
%       1/6  1/3  1/3  1/3  1/7  1/2  1/2  1/5  1/2  1/5  1/2]


%the3= [ 1/9 1/3 1/6 1/5 1/8];



the1= [ 1/23 1/45  1/44  1/33   1/59   1/34 1/9 1/38  1/23  1/63   1/45 1/64  1/66 1/53  1/34  1/93  1/87  1/23 1/32  1/54  1/32 1/45 1/23 1/83 1/99 1/23 1/23 1/35;
         1/45 1/98 1/23   1/33   1/58   1/64 1/89 1/38  1/53  1/83   1/45 1/64  1/96 1/53  1/38  1/19  1/87  1/23 1/32  1/53  1/39 1/75 1/53 1/33 1/97 1/83 1/53 1/85;

         1/40 1/98 1/23   1/30   1/58   1/64 1/80 1/38  1/53  1/80   1/45 1/64  1/96 1/53  1/38  1/59  1/87  1/23 1/32  1/53  1/89 1/75 1/53 1/33 1/77 1/83 1/53 1/85;
 

         1/25 1/98 1/93   1/33   1/58   1/64 1/19 1/38  1/53  1/83   1/95 1/64  1/96 1/53  1/38  1/19  1/67  1/23 1/32  1/33  1/39 1/65 1/53 1/83 1/97 1/83 1/33 1/85;


         1/49 1/90 1/23   1/83   1/58   1/44 1/89 1/68  1/53  1/23   1/45 1/64  1/96 1/33  1/38  1/79  1/87  1/93 1/32  1/43  1/39 1/55 1/53 1/93 1/97 1/33 1/53 1/56;



%         1/55 1/98 1/53   1/33   1/38   1/64 1/39 1/38  1/93  1/83   1/35 1/64  1/66 1/53  1/38  1/19  1/97  1/23 1/42  1/33  1/79 1/65 1/53 1/83 1/27 1/83 1/43 1/35;


         1/46 1/90 1/93   1/43   1/58   1/34 1/89 1/88  1/53  1/43   1/45 1/34  1/36 1/33  1/88  1/79  1/47  1/93 1/62  1/43  1/99 1/55 1/63 1/93 1/17 1/33 1/93 1/95]


%         1/85 1/78 1/23   1/43   1/98   1/64 1/59 1/38  1/93  1/83   1/65 1/64  1/46 1/53  1/98  1/19  1/37  1/23 1/82  1/53  1/39 1/75 1/53 1/33 1/37 1/83 1/43 1/45;


%         1/45 1/50 1/23   1/73   1/50   1/54 1/89 1/98  1/53  1/13   1/95 1/64  1/46 1/33  1/98  1/79  1/57  1/93 1/82  1/43  1/59 1/55 1/93 1/93 1/67 1/33 1/53 1/65;



%        1/34 1/89  1/44   1/69 1/64   1/32 1/86  1/45 1/83   1/34  1/87 1/76 1/96  1/54  1/34  1/64 1/99 1/32 1/87  1/33 1/34 1/32 1/54 1/43 1/34 1/87 1/56 1/34  ];


the2= [ 1/29 1/45 1/56 1/90 1/39 1/60 1/45;% 1/23 1/66 1/78 1/43;
        1/56 1/34 1/98 1/36 1/23 1/89 1/34;% 1/22 1/87 1/97 1/34;
        1/23 1/45 1/56 1/54 1/48 1/88 1/30;% 1/22 1/40 1/34 1/89;
        1/67 1/33 1/23 1/98 1/45 1/73 1/39;% 1/48 1/23 1/76 1/88 ];
        1/98 1/36 1/23 1/89 1/34 1/22 1/99;
        1/34 1/98 1/36 1/23 1/89 1/34 1/45]

 
the3= [ 1/59 1/43 1/86 1/50 1/78 1/34 1/88];



bd1=0;
bd2=0;
bd3=0;

lam = .001 ;


Hx_a = zeros(m,1);
Hx_b = zeros(m,1);

%jVal_diff= zeros(100,1);
jVal_diff = 1;
n=m;

for j=1:12734;

%while abs(jVal_diff)>.0000000001;

  for i=1:size(X,1);  a2 = [1; sigmoid(the1*X(i,:)')]; a3 = [1; sigmoid(the2*a2)]; hx = sigmoid(the3*a3); d4 = hx-y(i); d3 = the3'*d4.*a3.*(1-a3); d3=[d3(2,1);d3(3,1); d3(4,1); d3(5,1); d3(6,1); d3(7,1)];  d2 = the2'*d3.*a2.*(1-a2); d2 = [d2(2,1); d2(3,1);d2(4,1); d2(5,1); d2(6,1); d2(7,1)];  bd3 = bd3 + d4*a3'; bd2 = bd2 + d3*a2'; bd1 = bd1 + d2*(X(i,:)); end; 

%if j>8599;
if j==12734;
% calc jVal pre update
tmp_thetaVec = [the1(:);the2(:);the3(:)];
for k=1:m; A2(:,k) = [1; sigmoid(the1*X(k,:)')]; A3(:,k) = [1; sigmoid(the2*A2(:,k))];  Hx_a(k) = sigmoid(the3*A3(:,k)); end;

jVal_a = -(1./n).*sum(y.*(log(Hx_a))+(1-y).*(log(1-Hx_a)))+(lam/(2*n)).*sum(tmp_thetaVec.*tmp_thetaVec);
end;

% update the reset bds
the1 = the1 - (1/n)*(bd1 + lam*the1); the2 = the2 - (1/n)*(bd2 + lam*the2); the3 = the3 - (1/n)*(bd3 + lam*the3);  bd1=zeros(6,28); bd2= zeros(6,7); bd3=zeros(1,7); 

%if j>8599;
if j==12734;
% calc jVal after update
tmp_thetaVec = [the1(:);the2(:);the3(:)];
for k=1:m; A2(:,k) = [1; sigmoid(the1*X(k,:)')]; A3(:,k) = [1; sigmoid(the2*A2(:,k))];  Hx_b(k) = sigmoid(the3*A3(:,k)); end;

jVal_b = -(1./n).*sum(y.*(log(Hx_b))+(1-y).*(log(1-Hx_b)))+(lam/(2*n)).*sum(tmp_thetaVec.*tmp_thetaVec);

%jVal_diff(j-8599) = jVal_a - jVal_b;
jVal_diff = jVal_a - jVal_b;


end;

end;


s=struct('M',the1,'N',the2,'O',the3,'jVal_diff',jVal_diff);

json=savejson('s',s);

